syntax = "proto3";

package share;

option go_package = "/proto;sharepb";

// 分享信息结构
message ShareInfo {
  string share_id = 1;   // 分享唯一ID
  int64 file_id = 2;     // 被分享的文件
  int64 owner_id = 3;   // 文件所有者
  string password = 4;   // 可选分享密码
  int64 expire_at = 5;   // 过期时间戳 (秒)
  string created_at = 6; // 创建时间
}

// 创建分享请求
message CreateShareRequest {
  int64 file_id = 1;
  int64 owner_id = 2;
  string password = 3;   // 可选密码
  int64 expire_in = 4;   // 过期秒数
}

// 创建分享响应
message CreateShareResponse {
  string share_id = 1;
  string share_url = 2;
}

// 获取分享信息
message GetShareInfoRequest {
  string share_id = 1;
}

message GetShareInfoResponse {
  ShareInfo info = 1;
}

// 验证访问请求
message ValidateAccessRequest {
  string share_id = 1;
  string password = 2;
}

message ValidateAccessResponse {
  bool valid = 1;        // 密码是否正确
  int64 file_id = 2;     // 返回文件 ID（若验证通过）
  int64 owner_id = 3;   // 文件所有者
}

// 服务定义
service ShareService {
  rpc CreateShare(CreateShareRequest) returns (CreateShareResponse);
  rpc GetShareInfo(GetShareInfoRequest) returns (GetShareInfoResponse);
  rpc ValidateAccess(ValidateAccessRequest) returns (ValidateAccessResponse);
}
